<!doctype html><html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta><title>Python 文件去重 - 六月的风的博客</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#3273dc"><meta name="application-name" content="六月的风"><meta name="msapplication-TileImage" content="/img/favicon.ico"><meta name="msapplication-TileColor" content="#3273dc"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="六月的风"><meta name="apple-mobile-web-app-status-bar-style" content="default"><link rel="apple-touch-icon" sizes="256x256" href="/img/favicon.ico"><meta name="description" content="利用 Python 函数 filecmp.cmp(f1, f2, shallow&amp;#x3D;True) 或 自行检验文件大小、MD5 值和 SHA1 值，进行文件去重"><meta property="og:type" content="blog"><meta property="og:title" content="Python 文件去重"><meta property="og:url" content="http://blog.junewind.top/p/f4adc632/"><meta property="og:site_name" content="六月的风的博客"><meta property="og:description" content="利用 Python 函数 filecmp.cmp(f1, f2, shallow&amp;#x3D;True) 或 自行检验文件大小、MD5 值和 SHA1 值，进行文件去重"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://blog.junewind.top/img/og_image.png"><meta property="article:published_time" content="2022-10-16T05:56:43.000Z"><meta property="article:modified_time" content="2023-03-05T16:10:37.410Z"><meta property="article:author" content="JuneWind"><meta property="article:tag" content="实例"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://blog.junewind.top/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.junewind.top/p/f4adc632/"},"headline":"Python 文件去重","image":["http://blog.junewind.top/img/og_image.png"],"datePublished":"2022-10-16T05:56:43.000Z","dateModified":"2023-03-05T16:10:37.410Z","author":{"@type":"Person","name":"JuneWind"},"publisher":{"@type":"Organization","name":"六月的风的博客","logo":{"@type":"ImageObject","url":"http://blog.junewind.top/img/logo.png"}},"description":"利用 Python 函数 filecmp.cmp(f1, f2, shallow&#x3D;True) 或 自行检验文件大小、MD5 值和 SHA1 值，进行文件去重"}</script><link rel="canonical" href="http://blog.junewind.top/p/f4adc632/"><link rel="alternate" href="/atom.xml" title="六月的风的博客" type="application/atom+xml"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="/fontawesome/v6.0.0/css/all.css"><link rel="stylesheet" href="/CDNsourse/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><meta name="msvalidate.01" content="4C7C17D7E4C38864CD8AE33AE7177757"><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><link rel="stylesheet" href="/CDNsourse/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="/CDNsourse/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="/CDNsourse/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="/CDNsourse/npm/pace-js@1.2.4/pace.min.js"></script><meta name="follow.it-verification-code" content="GngM6haP84HTv9msCG6A"><script>window.MSInputMethodContext&amp;&amp;document.documentMode&amp;&amp;(window.location.href=&quot;/libs/upgrade-your-browser/index.html?referrer=&quot;+encodeURIComponent(window.location.href));</script><script src="/libs/JW/print-infos.min.js" async></script><script src="/junewind/random.js" async></script><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script src="https://sdk.51.la/perf/js-sdk-perf.min.js" crossorigin="anonymous"></script><noscript><img referrerpolicy="no-referrer-when-downgrade" src="https://matomo.junewind.top/matomo.php?idsite=3&amp;amp;rec=1" style="border:0" alt=""></noscript><script src="/js/ToFollowYou.js" async></script><script>!function(){function e(){var e,t,a;location.hash&&(e="#"+CSS.escape(location.hash.substring(1)),t=document.querySelector(`.tabs a[href="${e}"]`))&&(a=t.parentElement.parentElement,Array.from(a.children).forEach(e=>e.classList.remove("is-active")),Array.from(a.querySelectorAll("a")).map(e=>document.getElementById(e.getAttribute("href").substring(1))).forEach(e=>e.classList.add("is-hidden")),t&&t.parentElement.classList.add("is-active"),a=document.querySelector(e))&&a.classList.remove("is-hidden")}e(),window.addEventListener("hashchange",e,!1)}()</script><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="六月的风的博客" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">时间轴</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/links">友情链接</a><a class="navbar-item" href="/fcircle">朋友圈</a><a class="navbar-item" href="/comment">留言板</a><a class="navbar-item" href="/about">关于</a><a class="navbar-item" href="javascript:toRandomPost()">随便看看</a></div><div class="navbar-end"><a class="navbar-item night" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="My GitHub" href="https://github.com/luckerlin/"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time datetime="2022-10-16T05:56:43.000Z" title="2022/10/16 13:56:43">2022-10-16</time>发表</span><span class="level-item"><time datetime="2023-03-05T16:10:37.410Z" title="2023/3/6 00:10:37">2023-03-06</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Python/">Python</a></span><span class="level-item">10 分钟读完 (大约1426个字)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">Python 文件去重</h1><div class="content"><p>最近收集了三千多份近 12GB 的零散文件，发现其中有许多重复的，多占用很多空间。想用 Python 清除重复文件，便在百度上搜了搜方法，记录在下。</p><span id="more"></span><h2 id="最简便方法——利用官方库"><a href="#最简便方法——利用官方库" class="headerlink" title="最简便方法——利用官方库"></a>最简便方法——利用官方库</h2><p>在 Python 中有一个官方库—— <code>filecmp</code> ，库里有一个函数：<code>cmp()</code> ，就是用来对文件进行比较的，我们可以使用它来操作。函数的使用方法如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> filecmp</span><br><span class="line">filecmp.cmp(f1, f2, shallow=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>它包含了三个参数，其中前两个参数表示的是需要比较的两个文件的路径，shallow 默认的值是 True ，是只比较两个文件的元数据，包括创建的时间、大小，如果为 False 的时候，表示在对比文件的时候，还需要对文件的内容进行对比。</p><p>我把源代码扒下来了，以下是对源代码的详解（英文注释已翻译）：</p><figure class="highlight python"><figcaption><span>点击展开代码 >folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> stat</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># 缓存字典</span></span><br><span class="line">_cache = &#123;&#125;</span><br><span class="line"><span class="comment"># 定义 分块读取文件大小</span></span><br><span class="line">BUFSIZE = <span class="number">8</span>*<span class="number">1024</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clear_cache</span>():</span><br><span class="line">	<span class="string">&quot;&quot;&quot;清除 filecmp 缓存&quot;&quot;&quot;</span></span><br><span class="line">	_cache.clear()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_sig</span>(<span class="params">st</span>):</span><br><span class="line">	<span class="comment"># 返回文件 os.stat(f) 的返回文件的类型、文件的大小（以位为单位）、文件最后修改时间</span></span><br><span class="line">	<span class="keyword">return</span> stat.S_IFMT(st.st_mode), st.st_size, st.st_mtime</span><br><span class="line">	<span class="comment"># 返回元组格式 (文件的类型, 文件的大小, 文件最后修改时间)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_do_cmp</span>(<span class="params">f1, f2</span>):</span><br><span class="line">	bufsize = BUFSIZE</span><br><span class="line">	<span class="keyword">with</span> <span class="built_in">open</span>(f1, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> fp1, <span class="built_in">open</span>(f2, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> fp2:</span><br><span class="line">		<span class="comment"># 分块（大小为8*1024位）读取文件，比较各部分数据是否一致</span></span><br><span class="line">		<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">			b1 = fp1.read(bufsize)</span><br><span class="line">			b2 = fp2.read(bufsize)</span><br><span class="line">			<span class="keyword">if</span> b1 != b2:</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">			<span class="keyword">if</span> <span class="keyword">not</span> b1:</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cmp</span>(<span class="params">f1, f2, shallow=<span class="literal">True</span></span>):</span><br><span class="line">	<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">	比较两个文件。</span></span><br><span class="line"><span class="string">		参数：</span></span><br><span class="line"><span class="string">			f1 —— 第一个文件名</span></span><br><span class="line"><span class="string">			f2 —— 第二个文件名</span></span><br><span class="line"><span class="string">			shallow —— 只需检查stat签名（不读取文件）。默认为True。</span></span><br><span class="line"><span class="string">		返回值：</span></span><br><span class="line"><span class="string">			如果文件相同，则为True，否则为False。</span></span><br><span class="line"><span class="string">		此函数将缓存用于过去的比较和结果，如果缓存项的统计信息发生更改，则缓存项将无效。</span></span><br><span class="line"><span class="string">		可以通过调用 clear_cache() 来清除缓存。</span></span><br><span class="line"><span class="string">	&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># 获取两文件的 (文件的类型, 文件的大小, 文件最后修改时间)</span></span><br><span class="line">	s1 = _sig(os.stat(f1))</span><br><span class="line">	s2 = _sig(os.stat(f2))</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 如果检查两个文件是否为 stat.S_IFREG（普通文件）。</span></span><br><span class="line">	<span class="keyword">if</span> s1[<span class="number">0</span>] != stat.S_IFREG <span class="keyword">or</span> s2[<span class="number">0</span>] != stat.S_IFREG:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">	<span class="comment"># 如果 shallow 为 True ，则只比较文件的大小及文件最后修改时间，成立则返回 True</span></span><br><span class="line">	<span class="keyword">if</span> shallow <span class="keyword">and</span> s1 == s2:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">	<span class="comment"># 如果两文件大小不一致，返回 False</span></span><br><span class="line">	<span class="keyword">if</span> s1[<span class="number">1</span>] != s2[<span class="number">1</span>]:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># 获取(f1, f2, s1, s2)的值是否在缓存中。</span></span><br><span class="line">	<span class="comment"># 如果有，获取值；如没有，则运行 _do_cmp(f1, f2) 获取值。</span></span><br><span class="line">	outcome = _cache.get((f1, f2, s1, s2))</span><br><span class="line">	<span class="keyword">if</span> outcome <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">		outcome = _do_cmp(f1, f2)</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(_cache) &gt; <span class="number">100</span>:      <span class="comment"># 限制缓存的最大大小</span></span><br><span class="line">			clear_cache()</span><br><span class="line">		<span class="comment"># 把数据添加到缓存，再次比较时无需运行 _do_cmp(f1, f2)</span></span><br><span class="line">		_cache[f1, f2, s1, s2] = outcome</span><br><span class="line">	<span class="keyword">return</span> outcome</span><br></pre></td></tr></table></figure><h2 id="进阶自制方法"><a href="#进阶自制方法" class="headerlink" title="进阶自制方法"></a>进阶自制方法</h2><p>我的思路是：比较两文件的大小、MD5 值。后来担心文件对比不精确，有新增了比较 SHA1 值。</p><article class="message is-info"><div class="message-body"><p>环境介绍：<br>操作系统版本：Windows 7<br>使用软件：PyCharm Community Edition 2022.1<br>Python 版本：3.8.10</p></div></article><figure class="highlight python"><figcaption><span>点击展开代码 >folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建者：六月的风 JuneWind</span></span><br><span class="line"><span class="comment"># 文件名称：py_hash.py</span></span><br><span class="line"><span class="comment"># 创建时间：2022/10/15 星期六 13:39</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取文件的MD5值，适用于小文件</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getSmallFileMD5</span>(<span class="params">fileName</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(fileName, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">    file_md5 = hashlib.md5(data).hexdigest()</span><br><span class="line">    <span class="keyword">return</span> file_md5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取文件的MD5值，适用于较大文件</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getBigFileMD5</span>(<span class="params">fileName</span>):</span><br><span class="line">    m = hashlib.md5()  <span class="comment"># 创建 md5 对象</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(fileName, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> fobj:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            data = fobj.read(<span class="number">4096</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            m.update(data)  <span class="comment"># 更新 md5 对象</span></span><br><span class="line">    <span class="keyword">return</span> m.hexdigest()  <span class="comment"># 返回 md5 对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取文件的SHA1值</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getFileSHA1</span>(<span class="params">fileName</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(fileName, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">    file_sha1 = hashlib.sha1(data).hexdigest()</span><br><span class="line">    <span class="keyword">return</span> file_sha1</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(getSmallFileMD5(<span class="string">&#x27;test.zip&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(getBigFileMD5(<span class="string">&#x27;test.zip&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(getFileSHA1(<span class="string">&#x27;test.zip&#x27;</span>))</span><br></pre></td></tr></table></figure><p>其中，需要用到 <code>hashlib</code> 库来获取文件的 MD5 和 SHA1 值。我还未深入了解它们的算法，感兴趣的同志们可以自行参阅 <a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3/library/hashlib.html">官方文档</a> 。</p><br><p>在同一目录下新建 <code>main.py</code></p><figure class="highlight python"><figcaption><span>点击展开代码 >folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建者：六月的风 JuneWind</span></span><br><span class="line"><span class="comment"># 文件名称：main.py</span></span><br><span class="line"><span class="comment"># 创建时间：2022/10/15 星期六 14:25</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> os.path <span class="keyword">import</span> isfile, join</span><br><span class="line"><span class="keyword">import</span> py_hash</span><br><span class="line"></span><br><span class="line">_PATH_ = <span class="string">&#x27;D:\\&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取目录 _PATH_ 中所有的文件</span></span><br><span class="line">fileList = [f <span class="keyword">for</span> f <span class="keyword">in</span> os.listdir(_PATH_) <span class="keyword">if</span> isfile(join(_PATH_, f))]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 字典格式：&#123;文件名: [字节大小, 文件MD5值], ...&#125;</span></span><br><span class="line">file_size_md5 = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> fileList:</span><br><span class="line">	filePath = _PATH_ + <span class="string">&#x27;\\&#x27;</span> + file</span><br><span class="line"></span><br><span class="line">	fsize = os.stat(filePath).st_size</span><br><span class="line">	fmd5 = py_hash.getSmallFileMD5(filePath)</span><br><span class="line">	fsha1 = py_hash.getFileSHA1(filePath)</span><br><span class="line"></span><br><span class="line">	file_size_md5[file] = [fsize, fmd5, fsha1]</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(file_size_md5)</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">len</span>(fileList) != <span class="number">1</span>:</span><br><span class="line">	fileName = fileList[<span class="number">0</span>]</span><br><span class="line">	<span class="keyword">for</span> otherFlie <span class="keyword">in</span> fileList:</span><br><span class="line">		<span class="keyword">if</span> fileName != otherFlie:</span><br><span class="line">			<span class="keyword">if</span> file_size_md5[fileName] == file_size_md5[otherFlie]:</span><br><span class="line">				<span class="built_in">print</span>(<span class="string">f&#x27;Found: &lt;<span class="subst">&#123;fileName&#125;</span>&gt; &amp; &lt;<span class="subst">&#123;otherFlie&#125;</span>&gt;\nRemove: <span class="subst">&#123;otherFlie&#125;</span>&#x27;</span>)</span><br><span class="line">				otherFliePath = _PATH_ + <span class="string">&#x27;\\&#x27;</span> + otherFlie</span><br><span class="line">				<span class="keyword">if</span> os.path.exists(otherFliePath):</span><br><span class="line">					os.remove(otherFliePath)</span><br><span class="line">				<span class="keyword">else</span>:</span><br><span class="line">					<span class="built_in">print</span>(<span class="string">f&#x27;Not Found The File &lt;<span class="subst">&#123;otherFlie&#125;</span>&gt; !&#x27;</span>)</span><br><span class="line">	fileList.remove(fileName)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;Not Found!&#x27;</span>)</span><br></pre></td></tr></table></figure><p>以上这一段代码的关键在于熟练运用 os 库，获取文件名和文件字节大小。</p><h2 id="小总结"><a href="#小总结" class="headerlink" title="小总结"></a>小总结</h2><p>其实，两种方法本质上是一致的。求 MD5 值和 SHA1 值时也需要分块读取文件，用特殊的算法产生一段哈希值。总的来说，还是直接使用 <code>filecmp.cmp(f1, f2, shallow=False)</code> 比较方便，精确度与方法二几乎无差别（当参数 shallow 为 False 时）。如有疑问或错误之处，欢迎来评论区和我聊聊！</p></div><div class="article-licensing box"><div class="licensing-title"><p>Python 文件去重</p><p><a href="http://blog.junewind.top/p/f4adc632/">http://blog.junewind.top/p/f4adc632/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>JuneWind</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2022-10-16</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2023-03-06</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/%E5%AE%9E%E4%BE%8B/">实例</a></div><link rel="stylesheet" href="/CDNsourse/npm/social-share.js@1.0.16/dist/css/share.min.css"><div class="social-share"></div><script src="/CDNsourse/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧！</h3><h3 class="menu-label has-text-centered">您的赞助信息将添加至关于页的<a href="/about/#%E6%84%9F%E8%B0%A2%E5%90%8D%E5%8D%95">感谢名单</a>中。</h3><div class="buttons is-centered"><a class="button donate" href="https://afdian.net/a/junewind" target="_blank" rel="noopener" data-type="afdian"><span class="icon is-small"><i class="fas fa-charging-station"></i></span><span>爱发电</span></a><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/images/donates/Alipay.jpg" alt="支付宝"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/images/donates/WeChat.jpg" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/p/4a17b156/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Hello World</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/p/7ea80d1a/"><span class="level-item">新型冠状病毒全国疫情 API 接口</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div class="content twikoo" id="twikoo"></div><script src="/libs/twikoo/twikoo@1.6.8.all.min.js"></script><script>twikoo.init({envId:"https://artalk.junewind.top/",lang:"zh-CN"})</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://thirdqq.qlogo.cn/g?b=sdk&amp;nk=2700261044&amp;s=140" alt="六月的风"></figure><p class="title is-size-4 is-block" style="line-height:inherit">六月的风</p><p class="is-size-6 is-block">花开堪折直须折, 莫待无花空折枝。</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Huzhou, Zhejiang, China, Asia, Earth, Solar System</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">9</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">5</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">5</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://space.bilibili.com/3493123875408616" target="_blank" rel="noopener">在 bilibili 关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/luckerlin/"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="QQ" href="tencent://Message/?Uin=2700261044&amp;websiteName=www.oicqzone.com&amp;Menu=yes"><i class="fab fa-qq"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Telegram" href="https://t.me/JuneWind/"><i class="fab fa-telegram"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:me@junewind.top"><i class="fas fa-envelope"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget"><div id="aplayer" style="margin:0 auto"></div><script src="/music/APlayer.min.js"></script><script src="/music/APlayer_Music.js"></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Hexo-%E5%8D%9A%E5%AE%A2/"><span class="level-start"><span class="level-item">Hexo 博客</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/"><span class="level-start"><span class="level-item">Python</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%89%8D%E7%AB%AF/"><span class="level-start"><span class="level-item">前端</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%BD%AC%E5%8F%91/"><span class="level-start"><span class="level-item">转发</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E9%AB%98%E4%B8%AD%E5%AD%A6%E4%B9%A0%E5%88%86%E4%BA%AB/"><span class="level-start"><span class="level-item">高中学习分享</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time datetime="2023-08-02T07:24:50.000Z">2023-08-02</time></p><p class="title"><a href="/p/c2adb882/">【Python 爬虫初级教程 02】爬取百度翻译查询英文单词</a></p><p class="categories"><a href="/categories/Python/">Python</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2023-07-23T13:51:00.000Z">2023-07-23</time></p><p class="title"><a href="/p/c25746a5/">普通高中教科书数学必修一中信息技术应用部分中的软件整理及 Python 代码分享</a></p><p class="categories"><a href="/categories/%E9%AB%98%E4%B8%AD%E5%AD%A6%E4%B9%A0%E5%88%86%E4%BA%AB/">高中学习分享</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2023-03-20T13:45:43.000Z">2023-03-20</time></p><p class="title"><a href="/p/152e2c7f/">【Python 爬虫初级教程 01】手把手教你爬取12306网站列车车次信息</a></p><p class="categories"><a href="/categories/Python/">Python</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2023-03-07T00:00:00.000Z">2023-03-07</time></p><p class="title"><a href="/p/dd4a5138/">【双语转发】十四届全国人大一次会议记者会——外交部长秦刚答记者问</a></p><p class="categories"><a href="/categories/%E8%BD%AC%E5%8F%91/">转发</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2023-01-26T11:04:40.688Z">2023-01-26</time></p><p class="title"><a href="/p/encryption/">Hexo加密功能测试</a></p><p class="categories"><a href="/categories/Hexo-%E5%8D%9A%E5%AE%A2/">Hexo 博客</a></p></div></article></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Hexo/"><span class="tag">Hexo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/WebAPI/"><span class="tag">WebAPI</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%85%B3%E4%BA%8E%E6%9C%AC%E7%AB%99/"><span class="tag">关于本站</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%AE%9E%E4%BE%8B/"><span class="tag">实例</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%88%AC%E8%99%AB/"><span class="tag">爬虫</span><span class="tag">2</span></a></div></div></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#最简便方法——利用官方库"><span class="level-left"><span class="level-item">1</span><span class="level-item">最简便方法——利用官方库</span></span></a></li><li><a class="level is-mobile" href="#进阶自制方法"><span class="level-left"><span class="level-item">2</span><span class="level-item">进阶自制方法</span></span></a></li><li><a class="level is-mobile" href="#小总结"><span class="level-left"><span class="level-item">3</span><span class="level-item">小总结</span></span></a></li></ul></div></div><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="https://api.follow.it/subscription-form/M3dzR2M1QndiRENIckQya3F1NDZvVWtRa29kMTRKREVoQXdvaXpzQU5Sa3U2WnFJVk1pbkw1WVliUWVScTA5S1MzVm9VRGx3b2FBYTZaUitMVmsxZnpQQW5iVkF6UUpqa29lQTlwcEJ1cjJGeTdVU21wWFI4Y2NFUmQzMmVET3N8YTl2Z3lZUnRsbUN1TFFTNDUxbkZlYzNyQUd3Y01HaGlSKzBxZm1hMVdMMD0=/8" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="六月的风的博客" height="28"></a><p class="is-size-7"><span>&copy; 2020 - 2023 JuneWind</span><br>Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> with theme <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a>   Modified by <a href="https://github.com/luckerlin/" target="_blank" rel="noopener">JuneWind</a><br><span class="icon-MOE"></span> <a href="https://icp.gov.moe/?keyword=20232099" target="_blank" style="color:#4a4a4a">萌ICP备20232099号</a>   <a target="_blank" title="51la网站统计" href="https://v6.51.la/land/K0SG0pX3Q3TrkCSl" style="color:#4a4a4a">51LA统计</a>   <span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="My Mirror Blog Site On Github" href="https://luckerlin.github.io/"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="/CDNsourse/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="/CDNsourse/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="/CDNsourse/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn")</script><script>var IcarusThemeSettings={article:{highlight:{clipboard:!0,fold:"unfolded"}}}</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><script src="/CDNsourse/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load",()=>{window.cookieconsent.initialise({type:"info",theme:"edgeless",static:!1,position:"bottom-right",content:{message:"此网站使用Cookie来改善您的体验。",dismiss:"知道了！",allow:"允许使用Cookie",deny:"拒绝",link:"了解更多",policy:"网站政策",href:"https://blog.junewind.top/policy/index.html"},palette:{popup:{background:"#edeff5",text:"#838391"},button:{background:"#4b81e8"}}})})</script><script src="/CDNsourse/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="/CDNsourse/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load",()=>{"function"==typeof $.fn.lightGallery&&$(".article").lightGallery({selector:".gallery-item"}),"function"==typeof $.fn.justifiedGallery&&($(".justified-gallery > p > .gallery-item").length&&$(".justified-gallery > p > .gallery-item").unwrap(),$(".justified-gallery").justifiedGallery())})</script><script src="/js/main.js" defer></script><script src="/js/night.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener("DOMContentLoaded",function(){loadInsight({contentUrl:"/content.json"},{hint:"想要查找什么...",untitled:"(无标题)",posts:"文章",pages:"页面",categories:"分类",tags:"标签"})})</script></body></html>